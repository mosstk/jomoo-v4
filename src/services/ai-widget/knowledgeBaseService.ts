import { products } from '@/data/products';
import { smartToiletProducts } from '@/data/smart-toilet-products';
import { onePieceToiletProducts } from '@/data/one-piece-toilet-products';
import { basinProducts } from '@/data/basin-products';
import { bidetSprayProducts } from '@/data/bidet-spray-products';
import { faucetProducts } from '@/data/faucet-products';

export class KnowledgeBaseService {
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ó‡πå‡∏°‡∏µ - ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
  private static readonly websiteKnowledge = {
    // ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ
    categories: [
      'smart toilet', 'one piece toilet', 'basin', 'bathtub', 
      'shower enclosure', 'faucet', 'rain shower', 'bidet spray', 
      'urinal', 'accessories'
    ],
    
    // ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÉ‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ó‡πå
    pages: [
      'product', 'inspiration', 'service', 'about us', 'contact',
      'smart-toilet', 'one-piece-toilet', 'basin', 'bathtub',
      'shower-enclosure', 'faucet', 'rain-shower', 'bidet-spray',
      'uniral', 'accessories'
    ],

    // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
    company: {
      name: 'TOA JOMOO',
      description: '‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå‡∏™‡∏∏‡∏Ç‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏à‡∏≤‡∏Å‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô',
      services: ['‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á', '‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô', '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢', '‡πÇ‡∏ä‡∏ß‡πå‡∏£‡∏π‡∏°']
    },

    // ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏∏‡∏Ç‡∏†‡∏±‡∏ì‡∏ë‡πå
    relatedTerms: [
      '‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥', '‡∏´‡πâ‡∏≠‡∏á‡∏™‡πâ‡∏ß‡∏°', '‡∏™‡∏∏‡∏Ç‡∏†‡∏±‡∏ì‡∏ë‡πå', '‡∏Å‡πä‡∏≠‡∏Å‡∏ô‡πâ‡∏≥', '‡∏≠‡πà‡∏≤‡∏á‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤',
      '‡∏≠‡πà‡∏≤‡∏á‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥', '‡∏ù‡∏±‡∏Å‡∏ö‡∏±‡∏ß', '‡πÇ‡∏ñ‡∏™‡∏∏‡∏Ç‡∏†‡∏±‡∏ì‡∏ë‡πå', '‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏õ‡∏≤', '‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß',
      '‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á', '‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°', '‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô', '‡∏£‡∏≤‡∏Ñ‡∏≤', '‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô', '‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î',
      '‡∏™‡πÄ‡∏õ‡∏Ñ', '‡∏Ç‡∏ô‡∏≤‡∏î', '‡∏ß‡∏±‡∏™‡∏î‡∏∏', '‡∏™‡∏µ', '‡∏£‡∏∏‡πà‡∏ô', '‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå', '‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û',
      '‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏ô‡πâ‡∏≥', '‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÑ‡∏ü', '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ', '‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞', '‡∏™‡∏°‡∏≤‡∏£‡πå‡∏ó',
      'TOA', 'JOMOO', '‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô', '‡πÇ‡∏ä‡∏ß‡πå‡∏£‡∏π‡∏°', '‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢', '‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤',
      '‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏±‡∏Å‡∏©‡∏≤', '‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î', '‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ', '‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠', '‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥',
      'shower', 'enclosure', 'basin', 'toilet', 'faucet', 'bidet', 'spray',
      'rain', 'urinal', 'accessories', 'smart', 'piece', 'one'
    ],

    // ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡πÑ‡∏î‡πâ
    allowedTopics: [
      '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', '‡∏™‡πÄ‡∏õ‡∏Ñ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', '‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á', 
      '‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô', '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢', '‡πÇ‡∏ä‡∏ß‡πå‡∏£‡∏π‡∏°', '‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢',
      '‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', '‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ã‡∏∑‡πâ‡∏≠', '‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏±‡∏Å‡∏©‡∏≤',
      '‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó TOA JOMOO'
    ]
  };

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ó‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  static isQuestionRelevant(message: string): { isRelevant: boolean; reason?: string } {
    const lowerMessage = message.toLowerCase().trim();
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
    if (lowerMessage.length < 2) {
      return {
        isRelevant: false,
        reason: '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ'
      };
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß, ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏™‡∏∏‡πà‡∏°)
    const nonsensePatterns = [
      /^[‡∏Å-‡∏Æ]{1,2}[‡∏Å-‡∏Æ]{1,2}[‡∏Å-‡∏Æ]{1,2}[‡∏Å-‡∏Æ]{1,2}/, // ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÑ‡∏ó‡∏¢‡∏™‡∏∏‡πà‡∏°
      /[‡∏Å-‡∏Æ]+[a-z]+[‡∏Å-‡∏Æ]+[a-z]+/, // ‡∏ú‡∏™‡∏°‡πÑ‡∏ó‡∏¢-‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°
      /\d{5,}/, // ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏¢‡∏≤‡∏ß‡πÜ
      /[!@#$%^&*()]{3,}/, // ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞
      /(.)\1{4,}/, // ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ã‡πâ‡∏≥‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞
    ];

    const isNonsense = nonsensePatterns.some(pattern => pattern.test(lowerMessage));
    if (isNonsense) {
      return {
        isRelevant: false,
        reason: '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î'
      };
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏≥)
    const thaiWords = [
      '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ', '‡∏£‡∏≤‡∏Ñ‡∏≤', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£', '‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠', '‡πÇ‡∏ä‡∏ß‡πå‡∏£‡∏π‡∏°', 
      '‡∏ä‡∏°', '‡∏î‡∏π', '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', '‡∏ã‡∏∑‡πâ‡∏≠', '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥', '‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥', '‡∏™‡∏∏‡∏Ç‡∏†‡∏±‡∏ì‡∏ë‡πå', '‡∏Å‡πä‡∏≠‡∏Å',
      '‡∏≠‡πà‡∏≤‡∏á', '‡∏ù‡∏±‡∏Å‡∏ö‡∏±‡∏ß', '‡πÇ‡∏ñ', '‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á', '‡∏ã‡πà‡∏≠‡∏°', '‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô', '‡∏™‡πÄ‡∏õ‡∏Ñ',
      '‡∏Ç‡∏ô‡∏≤‡∏î', '‡∏ß‡∏±‡∏™‡∏î‡∏∏', '‡∏™‡∏µ', '‡∏£‡∏∏‡πà‡∏ô', '‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå', '‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û', '‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î',
      '‡∏™‡∏°‡∏≤‡∏£‡πå‡∏ó', '‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞', '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ', '‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢', '‡∏î‡∏π‡πÅ‡∏•', '‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î',
      '‡∏ß‡∏¥‡∏ò‡∏µ', '‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠', '‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤', '‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢', '‡∏≠‡∏∞‡πÑ‡∏£', '‡πÑ‡∏´‡∏ô', '‡∏¢‡∏±‡∏á‡πÑ‡∏á',
      '‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà', '‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô', '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà', '‡∏ó‡∏≥‡πÑ‡∏°', '‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£', '‡∏°‡∏µ', '‡πÅ‡∏ö‡∏ö',
      '‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå', '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥', '‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå', '‡∏ä‡πà‡∏ß‡∏¢', 'enclosure', '‡πÄ‡∏õ‡πá‡∏ô',
      '‡πÉ‡∏ä‡πâ', '‡∏à‡∏≤‡∏Å', '‡∏Ç‡∏≠‡∏á', '‡πÉ‡∏´‡πâ', '‡πÑ‡∏î‡πâ', '‡πÄ‡∏û‡∏∑‡πà‡∏≠', '‡∏Å‡∏±‡∏ö', '‡πÅ‡∏•‡∏∞', '‡∏´‡∏£‡∏∑‡∏≠'
    ];

    const hasValidThaiWord = thaiWords.some(word => lowerMessage.includes(word));
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
    const englishWords = [
      'toa', 'jomoo', 'toilet', 'smart', 'basin', 'faucet', 'shower', 
      'bidet', 'spray', 'bathroom', 'price', 'install', 'warranty',
      'hello', 'hi', 'how', 'what', 'where', 'when', 'why'
    ];

    const hasValidEnglishWord = englishWords.some(word => lowerMessage.includes(word));
    
    // ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏¢
    if (!hasValidThaiWord && !hasValidEnglishWord) {
      return {
        isRelevant: false,
        reason: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°'
      };
    }
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏∏‡∏Ç‡∏†‡∏±‡∏ì‡∏ë‡πå
    const hasRelevantTerms = this.websiteKnowledge.relatedTerms.some(term => 
      lowerMessage.includes(term.toLowerCase())
    );

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
    const hasProductCategory = this.websiteKnowledge.categories.some(category =>
      lowerMessage.includes(category.replace(/\s+/g, ''))
    );

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå
    const hasBrandName = lowerMessage.includes('toa') || 
                        lowerMessage.includes('jomoo') ||
                        lowerMessage.includes('‡πÇ‡∏ï‡∏≠‡∏≤');

    // ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß)
    const generalQuestions = [
      '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ', '‡∏£‡∏≤‡∏Ñ‡∏≤', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£', '‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠',
      '‡πÇ‡∏ä‡∏ß‡πå‡∏£‡∏π‡∏°', '‡∏ä‡∏°', '‡∏î‡∏π', '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', '‡∏ã‡∏∑‡πâ‡∏≠', '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥', 'hello', 'hi'
    ];
    
    const hasGeneralTerms = generalQuestions.some(term =>
      lowerMessage.includes(term)
    );

    // ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
    const irrelevantTopics = [
      '‡∏≠‡∏≤‡∏´‡∏≤‡∏£', '‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤', '‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå', '‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå', '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå',
      '‡πÄ‡∏Å‡∏°', '‡∏´‡∏ô‡∏±‡∏á', '‡πÄ‡∏û‡∏•‡∏á', '‡∏Å‡∏µ‡∏¨‡∏≤', '‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á', '‡∏´‡∏∏‡πâ‡∏ô', '‡∏Ñ‡∏£‡∏¥‡∏õ‡πÇ‡∏ï',
      '‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß', '‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°', '‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£', '‡πÇ‡∏£‡∏á‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡∏£‡πå',
      '‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', '‡∏û‡∏∑‡∏ä‡∏ú‡∏±‡∏Å', '‡∏¢‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏£‡∏Ñ', '‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•',
      '‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', '‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢', '‡∏á‡∏≤‡∏ô', '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô'
    ];

    const hasIrrelevantTopics = irrelevantTopics.some(topic =>
      lowerMessage.includes(topic)
    );

    if (hasIrrelevantTopics) {
      return {
        isRelevant: false,
        reason: '‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏∏‡∏Ç‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á TOA JOMOO'
      };
    }

    if (hasRelevantTerms || hasProductCategory || hasBrandName || hasGeneralTerms) {
      return { isRelevant: true };
    }

    return {
      isRelevant: false,
      reason: '‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ó‡πå'
    };
  }

  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ
  static getAllProducts() {
    return {
      smartToilet: smartToiletProducts,
      onePieceToilet: onePieceToiletProducts,
      basin: basinProducts,
      bidetSpray: bidetSprayProducts,
      faucet: faucetProducts,
      general: products
    };
  }

  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà AI ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÑ‡∏î‡πâ
  static getAvailableKnowledge() {
    return {
      products: this.getAllProducts(),
      categories: this.websiteKnowledge.categories,
      company: this.websiteKnowledge.company,
      services: this.websiteKnowledge.company.services,
      pages: this.websiteKnowledge.pages
    };
  }

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
  static getIrrelevantQuestionResponse(reason?: string): string {
    // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©
    if (reason === '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î' || reason === '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°') {
      return `‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≤‡∏ô‡∏™‡πà‡∏á‡∏°‡∏≤‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô 

üí¨ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡πÄ‡∏ä‡πà‡∏ô:
‚Ä¢ "‡∏£‡∏≤‡∏Ñ‡∏≤ Smart Toilet ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?"
‚Ä¢ "Bidet Spray ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏¢‡∏≤‡∏Å‡πÑ‡∏´‡∏°?"
‚Ä¢ "‡∏≠‡∏¢‡∏≤‡∏Å‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡πà‡∏≤‡∏á‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤"

üìù ‡∏ú‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏±‡∏ì‡∏ë‡πå TOA JOMOO ‡∏Ñ‡∏£‡∏±‡∏ö`;
    }

    const responses = [
      `‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á TOA JOMOO

üè¢ ‡∏ú‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á:
‚Ä¢ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏∏‡∏Ç‡∏†‡∏±‡∏ì‡∏ë‡πå (Smart Toilet, Basin, Faucet, ‡∏Ø‡∏•‡∏Ø)
‚Ä¢ ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡πÄ‡∏õ‡∏Ñ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
‚Ä¢ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏±‡∏Å‡∏©‡∏≤
‚Ä¢ ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô
‚Ä¢ ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ä‡∏°‡πÇ‡∏ä‡∏ß‡πå‡∏£‡∏π‡∏°

‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏∏‡∏Ç‡∏†‡∏±‡∏ì‡∏ë‡πå TOA JOMOO ‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?`,

      `‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á TOA JOMOO ‡∏Ñ‡∏£‡∏±‡∏ö

‚ú® ‡∏ú‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á:
‚Ä¢ ‡∏™‡∏∏‡∏Ç‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥
‚Ä¢ Smart Toilet ‡πÅ‡∏•‡∏∞ One Piece Toilet
‚Ä¢ ‡∏≠‡πà‡∏≤‡∏á‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ ‡∏Å‡πä‡∏≠‡∏Å‡∏ô‡πâ‡∏≥ ‡∏ù‡∏±‡∏Å‡∏ö‡∏±‡∏ß
‚Ä¢ ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
‚Ä¢ ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢

‡∏•‡∏≠‡∏á‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ TOA JOMOO ‡∏î‡∏π‡∏Ñ‡∏£‡∏±‡∏ö!`
    ];

    return responses[Math.floor(Math.random() * responses.length)];
  }
}